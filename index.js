function $$(e,r){return Array.prototype.slice.call((r||document).querySelectorAll(e))}function hexToBytes(e){for(var r=[],t=0;t<e.length;t+=2)r.push(parseInt(e.substr(t,2),16));return r}function bytesToHex(e){for(var r=[],t=0;t<e.length;t++){var s=e[t]<0?e[t]+256:e[t];r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")}function is_hex(e){return/^[0-9a-f]+$/.test(e)}function bytesToBase64(e){e=String.fromCharCode.apply(null,e);return btoa(e).replace(/.{76}(?=.)/g,"$&\n")}function base64ToBytes(e){return atob(e)}function bytesToUrlSafeBase64(e){return bytesToBase64(e).replaceAll("+","-").replaceAll("/","_")}function urlSafeBase64ToBytes(e){return base64ToBytes(e.replaceAll("-","+").replaceAll("_","/"))}function parseQuery(e){for(var r={},t=e.split("&"),s=0;s<t.length;s++){var o=t[s].split("=");r[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||"")}return r}function getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}function setUrl(e,r){e=$$(e)[0];e.href=r,e.innerText=r}function show(e,r){$$(e)[0].innerText=r}function parse(e){var r=e.split("://"),t=r[0];if("tg"!=t&&"https"!=t)return alert("invalid URL protocol: "+t),!1;e=(r=r[1].split("?"))[0];if("tg"==t&&"proxy"!=e)return alert("invalid path: "+e),!1;if("https"==t&&"t.me/proxy"!=e)return alert("invalid path: "+e),!1;var s=parseQuery(r[1]),e=["server","port","secret"].filter(e=>!s.hasOwnProperty(e));if(e.length)return alert("Missing: "+e),!1;var o,r=s.secret,e="";if(32==r.length&&is_hex(r))n="Normal",o=r;else if(34==r.length&&r.startsWith("dd")&&is_hex(r))n="Secure",o=r.slice(-32);else if(34<r.length&&r.startsWith("ee")&&is_hex(r))n="Fake-TLS, hex secret",o=r.slice(2,34),e=String.fromCharCode.apply(null,hexToBytes(r.slice(34)));else if(r.startsWith("7")){var a,n="Fake-TLS";if(/^[0-9a-zA-Z_=-]+$/.test(r))a=urlSafeBase64ToBytes(r),n+=", URL-safe base64 secret";else{if(!/^[0-9a-zA-Z\+\/=]+$/.test(r))return alert("Invalid secret: "+r),!1;a=base64ToBytes(r),n+=", base64 sectet"}o=bytesToHex(Array.from(a.slice(1,17),e=>e.charCodeAt(0))),e=a.slice(17)}else alert("Invalid secret: "+r);return{protocol:n,server:s.server,port:s.port,secret:o,domain:e}}document.addEventListener("DOMContentLoaded",function(){$$("#generate")[0].onclick=function(){var e=$$("#generator-form")[0],r=e.server.value,t=e.port.value,s=e.secret.value,o=e.domain.value,a=$$('input[name="url_type"]:checked',e)[0].value,e=(hexToBytes(s),"dd"+s),o=Array.from(o).map(e=>e.charCodeAt(0)),o=hexToBytes("ee"+s).concat(o),t=a+"proxy?server="+r+"&port="+t+"&secret=";setUrl("#url-normal",t+s),setUrl("#url-dd",t+e),setUrl("#url-tls-hex",t+encodeURIComponent(bytesToHex(o))),setUrl("#url-tls-b64",t+bytesToBase64(o)),setUrl("#url-tls-safeb64",t+bytesToUrlSafeBase64(o))},$$("#rand-secret")[0].onclick=function(){for(var e=[],r=0;r<16;r++)e.push(getRandomInt(256));$$("#secret")[0].value=bytesToHex(e)},$$("#parse")[0].onclick=function(){var e=parse($$("#parser-form")[0]["parse-link"].value);show("#parse-protocol",e.protocol),show("#parse-server",e.server),show("#parse-port",e.port),show("#parse-hex-secret",e.secret),show("#parse-domain",e.domain)},$$("#parse-and-generate")[0].onclick=function(){var e=$$("#parser-form")[0],r=parse(e["parse-link"].value);(e=$$("#generator-form")[0]).server.value=r.server,e.port.value=r.port,e.secret.value=r.secret,e.domain.value=r.domain,$$("#generate")[0].onclick(),show("#parse-protocol",r.protocol),show("#parse-server",r.server),show("#parse-port",r.port),show("#parse-hex-secret",r.secret),show("#parse-domain",r.domain)}});